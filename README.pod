package App::genconf;

#ABSTRACT: The world's simplest config file generator

use strict;
use warnings;

use Getopt::Long qw(GetOptions :config bundling);
use Template;

=head1 NAME

App::genconf

=head1 SYNOPSIS

=head1 METHODS

=head2 new

=cut

sub new {
    my ( $class, $inc ) = @_;
    $inc = [@INC] unless ref $inc eq 'ARRAY';
    bless { verbose => 0, }, $class;
}

=head2 run

=cut

sub run {
    my ( $self, @args ) = @_;
    local @ARGV = @args;
    GetOptions(
        'v|verbose!' => sub { ++$self->{verbose} },
        'V|version!' => \$self->{version},
        'config-dir' => \$self->{config_dir},
    ) or $self->usage;

    if ( $self->{version} ) {
        $self->puts("genconf (App::genconf) version $App::genconf::VERSION");
        exit 1;
    }

    if ( -d $ARGV[0] ) {
        opendir( DH, $ARGV[0] );
        my @files = readdir(DH);
        closedir(DH);

        $self->_generate_config($_) for @files;
    }
    elsif ( -f $ARGV[0] ) {
        $self->_generate_config($ARGV[0]);
    }

}

=head2 usage

=cut

sub usage {
    my $self = shift;
    $self->puts(<< 'USAGE');
Usage:
  genconf [options] template|dir

  options:
    -v,--verbose                  Turns on chatty output
    --config-dir                  Specify config file directory, default .
USAGE

    exit 1;
}

=head2 _generate_config

=cut

sub _generate_config {
    my $self     = shift;
    my $template = shift;

    die 'Must specify template name' unless $ARGV[0];

    my $tt = Template->new() || die "$Template::ERROR\n";
    $tt->process( $template, \%ENV ) || die $tt->error();

    return 1;
}

1;
